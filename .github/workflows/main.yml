name: BugKiller CI

# 1. Trigger: When code is pushed to the 'main' or 'master' branch
on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  test:
    # 2. Environment: Use the latest Ubuntu image
    runs-on: ubuntu-latest

    steps:
    # 3. Checkout: Download the code to the runner
    - uses: actions/checkout@v4

    # 4. Run Everything using Docker Compose
    - name: Build and Run with Docker Compose
      run: |
        docker compose up -d --build
        echo "Waiting for services to be ready..."
        sleep 20  # Give MySQL time to initialize

    # 5. Run API Tests
    - name: Run API Tests
      run: |
        docker compose exec -T web pytest tests/test_api.py

    # 6. Run UI Tests (POM) - SKIP (Requires Playwright in Docker)
    # - name: Run UI Tests
    #   run: |
    #     docker compose exec -T web pytest tests/test_ui.py

    # 7. Cleanup
    - name: Shutdown containers
      if: always()
      run: docker compose down
